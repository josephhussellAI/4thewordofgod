---
import Layout from '../layouts/Layout.astro';
import BookCard from '../components/BookCard.astro';
import { LANGUAGES } from '../lib/languages';
import fs from 'fs';
import path from 'path';

const languages = Object.values(LANGUAGES).map((l: any) => ({
    language_code: l.code,
    tier_level: 1, // Default
    direction: l.direction.toUpperCase(),
    region_name: l.name
}));

// Read homepage.json
const homepagePath = path.join(process.cwd(), 'public/public-content/en/homepage.json');
let homepageData;

try {
    const fileContent = fs.readFileSync(homepagePath, 'utf-8');
    homepageData = JSON.parse(fileContent);
} catch (error) {
    console.error("Error reading homepage.json:", error);
    // Fallback or empty state
    homepageData = {
        title: "Free Online Bible Commentaries",
        tagline: "Free to read and free to share.",
        sectionTitle: "The Commentaries",
        books: []
    };
}

const {
  site_title,
  tagline,
  commentaries_section_title,
  articles_section_title,
  commentaries,
  articles
} = homepageData;

// Get the 6 most recent articles
const recentArticles = articles.slice(0, 6);

// Create firstChapters map for Sidebar
const firstChapters = {};
commentaries.forEach(book => {
    firstChapters[book.book_name.toLowerCase()] = book.chapter_number;
});
---

<Layout title={site_title} description={tagline} firstChapters={firstChapters}>
  <main>
    <header class="hero">
      <h1>{site_title}</h1>
      <p class="tagline">{tagline}</p>
    </header>

    <section class="book-grid-section">
      <h2 class="section-title">{commentaries_section_title}</h2>
      <div class="books-grid">
        {commentaries.map((book) => (
          <BookCard
            title={book.title}
            description={book.metaDescription}
            link={`/en/${book.book_name.toLowerCase()}/${book.chapter_number}`}
            slug={book.book_name.toLowerCase()}
            type="commentary"
            toc={book.toc}
          />
        ))}
      </div>
    </section>

    {recentArticles.length > 0 && (
      <section class="book-grid-section">
        <h2 class="section-title">{articles_section_title}</h2>
        <div class="books-grid">
          {recentArticles.map((article) => (
            <BookCard
              title={article.title}
              description={article.metaDescription}
              link={`/en/articles/${article.book_name.toLowerCase().replace(/\s+/g, '-')}`}
              type="article"
            />
          ))}
        </div>
      </section>
    )}
  </main>
</Layout>

<style>
	.home-container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 2rem 0;
	}

	.hero {
		text-align: center;
		margin-bottom: 4rem;
		padding: 4rem 0;
	}



	.hero-subtitle {
		font-size: 1.1rem;
		color: var(--theme-text);
        opacity: 0.8;
		max-width: 600px;
		margin: 0 auto;
	}

	.section-title {
		font-family: 'Cinzel', serif;
		font-size: 1.5rem;
		color: var(--theme-text);
		margin-bottom: 2rem;
		text-transform: uppercase;
		letter-spacing: 1px;
		border-bottom: 1px solid var(--theme-border);
		padding-bottom: 0.5rem;
		display: inline-block;
	}

	.books-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 2rem;
        padding: 0 1rem;
	}

    @media (min-width: 640px) {
        .books-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .books-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (min-width: 1280px) {
        .books-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
</style>
